<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Connection Test - Business CRM</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-900 mb-8">API Connection Test</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Django API Test -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-semibold text-gray-900 mb-4">Django Backend API</h2>
                <div id="django-status" class="mb-4">
                    <span class="text-gray-500">Testing connection...</span>
                </div>
                <button onclick="testDjangoAPI()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">
                    Test Connection
                </button>
                <pre id="django-response" class="mt-4 p-3 bg-gray-50 rounded text-xs overflow-auto max-h-40"></pre>
            </div>
            
            <!-- Frontend Test -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-semibold text-gray-900 mb-4">Frontend Status</h2>
                <div id="frontend-status" class="mb-4">
                    <span class="text-gray-500">Checking frontend...</span>
                </div>
                <button onclick="testFrontend()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">
                    Test Frontend
                </button>
                <pre id="frontend-response" class="mt-4 p-3 bg-gray-50 rounded text-xs overflow-auto max-h-40"></pre>
            </div>
        </div>
        
        <!-- CORS Test -->
        <div class="mt-6 bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">CORS Configuration Test</h2>
            <div id="cors-status" class="mb-4">
                <span class="text-gray-500">Testing CORS...</span>
            </div>
            <button onclick="testCORS()" class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded">
                Test CORS
            </button>
            <pre id="cors-response" class="mt-4 p-3 bg-gray-50 rounded text-xs overflow-auto max-h-40"></pre>
            
            <!-- CORS Fix Instructions -->
            <div class="mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded">
                <h3 class="font-semibold text-yellow-800">If CORS errors occur, add to Django settings.py:</h3>
                <pre class="mt-2 text-sm bg-yellow-100 p-2 rounded">
pip install django-cors-headers

# In settings.py:
INSTALLED_APPS = [
    'corsheaders',
    # ... other apps
]

MIDDLEWARE = [
    'corsheaders.middleware.CorsMiddleware',
    'django.middleware.common.CommonMiddleware',
    # ... other middleware
]

CORS_ALLOWED_ORIGINS = [
    "http://localhost:8080",
    "http://127.0.0.1:8080",
]

# For development only:
CORS_ALLOW_ALL_ORIGINS = True
                </pre>
            </div>
        </div>
        
        <!-- Quick Actions -->
        <div class="mt-6 bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">Quick Actions</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <a href="index.html" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-center">
                    Open CRM
                </a>
                <a href="http://127.0.0.1:8000/admin/" target="_blank" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded text-center">
                    Django Admin
                </a>
                <a href="http://127.0.0.1:8000/api/" target="_blank" class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded text-center">
                    API Root
                </a>
                <button onclick="runAllTests()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded">
                    Run All Tests
                </button>
            </div>
        </div>
    </div>

    <script>
        async function testDjangoAPI() {
            const statusEl = document.getElementById('django-status');
            const responseEl = document.getElementById('django-response');
            
            statusEl.innerHTML = '<span class="text-yellow-500">⏳ Testing Django API...</span>';
            
            try {
                // Test basic connection
                const response = await fetch('http://127.0.0.1:8000/api/', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const data = await response.text();
                
                if (response.ok) {
                    statusEl.innerHTML = '<span class="text-green-500">✅ Django API is running!</span>';
                    responseEl.textContent = `Status: ${response.status}\n${data}`;
                } else {
                    statusEl.innerHTML = '<span class="text-red-500">❌ Django API error</span>';
                    responseEl.textContent = `Status: ${response.status}\n${data}`;
                }
            } catch (error) {
                statusEl.innerHTML = '<span class="text-red-500">❌ Cannot connect to Django API</span>';
                responseEl.textContent = `Error: ${error.message}\n\nMake sure Django is running on 127.0.0.1:8000`;
            }
        }
        
        async function testFrontend() {
            const statusEl = document.getElementById('frontend-status');
            const responseEl = document.getElementById('frontend-response');
            
            statusEl.innerHTML = '<span class="text-yellow-500">⏳ Testing frontend...</span>';
            
            try {
                const response = await fetch('index.html');
                const data = await response.text();
                
                if (response.ok) {
                    statusEl.innerHTML = '<span class="text-green-500">✅ Frontend is working!</span>';
                    responseEl.textContent = `Status: ${response.status}\nSize: ${data.length} bytes\nServer: ${response.headers.get('server') || 'Unknown'}`;
                } else {
                    statusEl.innerHTML = '<span class="text-red-500">❌ Frontend error</span>';
                    responseEl.textContent = `Status: ${response.status}`;
                }
            } catch (error) {
                statusEl.innerHTML = '<span class="text-red-500">❌ Frontend error</span>';
                responseEl.textContent = `Error: ${error.message}`;
            }
        }
        
        async function testCORS() {
            const statusEl = document.getElementById('cors-status');
            const responseEl = document.getElementById('cors-response');
            
            statusEl.innerHTML = '<span class="text-yellow-500">⏳ Testing CORS...</span>';
            
            try {
                const response = await fetch('http://127.0.0.1:8000/api/', {
                    method: 'OPTIONS',
                    headers: {
                        'Origin': window.location.origin,
                        'Access-Control-Request-Method': 'GET',
                        'Access-Control-Request-Headers': 'Content-Type, Authorization'
                    }
                });
                
                const corsHeaders = {
                    'Access-Control-Allow-Origin': response.headers.get('Access-Control-Allow-Origin'),
                    'Access-Control-Allow-Methods': response.headers.get('Access-Control-Allow-Methods'),
                    'Access-Control-Allow-Headers': response.headers.get('Access-Control-Allow-Headers'),
                };
                
                if (corsHeaders['Access-Control-Allow-Origin']) {
                    statusEl.innerHTML = '<span class="text-green-500">✅ CORS is configured!</span>';
                    responseEl.textContent = JSON.stringify(corsHeaders, null, 2);
                } else {
                    statusEl.innerHTML = '<span class="text-red-500">❌ CORS not configured</span>';
                    responseEl.textContent = 'No CORS headers found. Please configure django-cors-headers.';
                }
            } catch (error) {
                statusEl.innerHTML = '<span class="text-red-500">❌ CORS test failed</span>';
                responseEl.textContent = `Error: ${error.message}`;
            }
        }
        
        async function runAllTests() {
            await testDjangoAPI();
            await new Promise(resolve => setTimeout(resolve, 500));
            await testFrontend();
            await new Promise(resolve => setTimeout(resolve, 500));
            await testCORS();
        }
        
        // Auto-run tests on page load
        window.onload = () => {
            setTimeout(runAllTests, 1000);
        };
    </script>
</body>
</html>